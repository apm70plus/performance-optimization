# Linux性能优化

## 准备工作
- 准备一台linux服务器，本文以ubuntu服务器为例

## Linux系统常用的性能分析指标

### 系统平均负载
平均负载（load average）体现了单位时间内占用cpu时间的进程数和等待cpu时间的进程数。通过系统平均负载的值，我们可以直观的感受到系统的负荷是高还是低。参考**阮一峰**的[理解Linux系统负荷](http://www.ruanyifeng.com/blog/2011/07/linux_load_average_explained.html)一文，文中阮一峰的举例非常形象的表达了什么是系统负载

假设最简单的情况，你的电脑只有一个CPU，所有的运算都必须由这个CPU来完成。
不妨把这个CPU想象成一座大桥，桥上只有一根车道，所有车辆都必须从这根车道上通过。（很显然，这座桥只能单向通行。）

- 系统负荷为0，意味着大桥上一辆车也没有。  
![负荷0](http://www.ruanyifeng.com/blogimg/asset/201107/bg2011073004.png)

- 系统负荷为0.5，意味着大桥一半的路段有车。  
![负荷0.5](http://www.ruanyifeng.com/blogimg/asset/201107/bg2011073005.png)

- 系统负荷为1.0，意味着大桥的所有路段都有车，也就是说大桥已经"满"了。但是必须注意的是，直到此时大桥还是能顺畅通行的。  
![负荷1.0](http://www.ruanyifeng.com/blogimg/asset/201107/bg2011073006.png)

- 系统负荷为1.7，意味着车辆太多了，大桥已经被占满了（100%），后面等着上桥的车辆为桥面车辆的70%。以此类推，系统负荷2.0，意味着等待上桥的车辆与桥面的车辆一样多；系统负荷3.0，意味着等待上桥的车辆是桥面车辆的2倍。总之，当系统负荷大于1，后面的车辆就必须等待了；系统负荷越大，过桥就必须等得越久。  
![负荷1.7](http://www.ruanyifeng.com/blogimg/asset/201107/bg2011073007.png)

不得不佩服，阮一峰大牛将复杂问题讲述的如此的简单透彻。对单核cpu而言，负载为1.0就说明需要处理的进程数刚刚好契合cpu的最大处理能力，对cpu的压榨达到极限而刚刚好还没有出现排队等待的进程。负载小于1.0说明cpu还有空闲。负载大于1.0说明cpu被压榨到极限仍然无法满足进程的请求，系统出现排队拥堵现象，必须尽快疏导。

对于多核处理器而言，系统负载值要根据核心数翻倍，n核心cpu，可接受的系统负载最大值就是n x 1.0

- 系统负荷的经验法则
  - 当系统负荷持续大于0.7，你必须开始调查了，问题出在哪里，防止情况恶化。
  - 当系统负荷持续大于1.0，你必须动手寻找解决办法，把这个值降下来。
  - 当系统负荷达到5.0，就表明你的系统有很严重的问题，长时间没有响应，或者接近死机了。
  
### CPU使用率
cpu使用率反映的是cpu当前时间的繁忙程度。  

那么它和系统平均负载又有什么区别呢？系统负载反映的是系统对请求进程的处理情况，在单位时间内，是否能处理完所有的请求进程，是还有富余还是已经出现排队，这与cpu使用率不一定有直接关联。因为有的进程是cpu密集型的处理，有的进程是io密集型的处理，这两类进程都可能导致系统平均负载过高。

### IO wait
**iowait** 表示在一个采样周期内有百分之几的时间属于以下情况：**CPU空闲**、并且**有仍未完成的I/O请求**。  
注意，必要条件是cpu要空闲，此时未完成的IO请求才计入iowait。  
在CPU繁忙期间发生的I/O，无论IO是多还是少，%iowait都不会变；当CPU繁忙程度下降时，有一部分IO落入CPU空闲时间段内，导致%iowait升高。
